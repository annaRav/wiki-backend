# Патчи для PROD окружения
# Оптимизированные ресурсы и Always pull policy

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: axis-goal
  namespace: axis
spec:
  template:
    spec:
      containers:
      - name: goal
        imagePullPolicy: Always  # Всегда pull последний образ из ghcr.io
        resources:
          requests:
            memory: "64Mi"
            cpu: "100m"
          limits:
            memory: "128Mi"
            cpu: "500m"
        livenessProbe:
          initialDelaySeconds: 15  # Native образы стартуют быстро
        readinessProbe:
          initialDelaySeconds: 10

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: axis-media
  namespace: axis
spec:
  template:
    spec:
      containers:
      - name: media
        imagePullPolicy: Always
        resources:
          requests:
            memory: "64Mi"
            cpu: "100m"
          limits:
            memory: "128Mi"
            cpu: "500m"
        livenessProbe:
          initialDelaySeconds: 15
        readinessProbe:
          initialDelaySeconds: 10

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: axis-notification
  namespace: axis
spec:
  template:
    spec:
      containers:
      - name: notification
        imagePullPolicy: Always
        resources:
          requests:
            memory: "64Mi"
            cpu: "100m"
          limits:
            memory: "128Mi"
            cpu: "500m"
        livenessProbe:
          initialDelaySeconds: 15
        readinessProbe:
          initialDelaySeconds: 10